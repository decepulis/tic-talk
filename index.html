<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Tic Talk</title>

	<!-- Style -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<link rel="stylesheet" href="./fullcalendar/fullcalendar.min.css">
	<link rel="stylesheet" href="./tictalk.css">

	<!-- Javascript -->
	<script type="text/javascript"  src="./fullcalendar/lib/jquery.min.js"></script>
	<script type="text/javascript"  src="./fullcalendar/lib/jquery-ui.min.js"></script>
	<script type="text/javascript"  src="./fullcalendar/lib/moment.min.js"></script>
	<script type="text/javascript"  src="./fullcalendar/fullcalendar.js"></script>
	<script type="text/javascript" src="./tictalk.js"></script>
</head>

<body>
	<div class="header"> Tic Talk
			<div class="header-button button" title="Log In/Out"     id="log-in"       data-popup="#log-in-popup">
				<i class="material-icons">account_circle</i>
			</div>
			<div class="header-button button" title="Add To-Do"      id="add-event"    data-popup="#add-event-popup">+</div>
			<div class="header-button button" title="Schedule This Week" id="schedule-week" data-popup="#schedule-week-popup">
				<i class="material-icons">format_list_numbered</i>
			</div>
	    </div>
		
		<div class="popup" id="log-in-popup">
	    	<div class="popup-overlay"></div>
	      	<div class="popup-container">
	        	<div class="popup-header">
	        		Account
	        	</div>
	        	<div class="popup-content"></div>
	        	<div class="popup-footer">
	        		<div class="textbutton button" onclick="closePopup();">SAVE</div>
	        		<div class="textbutton button" onclick="closePopup();">DISCARD</div>
	        	</div>
	    	</div>
	    </div>


		<div class="popup narrow" id="add-event-popup">
			<div class="popup-overlay"></div>
	      	<div class="popup-container">
	        	<div class="popup-header">
	        		Add Event
	        	</div>

	        	<div class="popup-content">
              <div class="popup-content-row">
                Task Title: 
                <input class="add-event-field" type="text" id="task-title-field" placeholder="e.g. Calc HW #5">
              </div>

              <div class="popup-content-row">
                Task Type:
                <div class="add-event-field" id="task-type-field" style="display:inline-block;white-space:nowrap;">
                  <select onchange="updateTaskTypeDropdown();">
                    <option value="no-selection">Select...</option>
                    <option>Add New Task Type</option>
                  </select>
                </div>
              </div>
              <div class="popup-content-row hidden" id="new-task-type-row">
                New Type:
                <input class="add-event-field" type="text" id="new-task-type-field" placeholder="e.g. Weekly Calc HW">
              </div>

              <div class="popup-content-row">&nbsp;</div>

              <div class="popup-content-row">
                Usually Takes:
                <i class="add-event-field" id="task-estimate-calc-field">0 Hours</i>
              </div>

              <div class="popup-content-row">
                Your Estimate: 
                <input class="add-event-field" type="number" min=0 id="task-estimate-given-field" placeholder="Hours">
              </div>

              <div class="popup-content-row">&nbsp;</div>
              

              <div class="popup-content-row">
                Due Date:  
                <input  class="add-event-field" type="date" id="task-due-date-field"> 
              </div>
            </div>

	        	<div class="popup-footer">
	        		<div class="textbutton button save" onclick="saveAddEventDialogue();">SAVE</div>
	        		<div class="textbutton button destructive" onclick="discardAddEventDialogue();">DISCARD</div>
	        	</div>
	    	</div>
	    </div>

	    <div class="popup" id="schedule-week-popup">
	    	<div class="popup-overlay"></div>
	      	<div class="popup-container">
	        	<div class="popup-header">
	        		Plan Your Week
	        	</div>
	        	<div class="popup-content"></div>
	        	<div class="popup-footer">
	        		<div class="textbutton button" onclick="closePopup();">SAVE</div>
	        		<div class="textbutton button" onclick="closePopup();">DISCARD</div>
	        	</div>
	    	</div>
	    </div>


	    <div class="calendar-container">
	    	<div id="calendar"></div>
	    </div>
	</body>

	<div>
		<p>Google Calendar API Quickstart</p>

		<!--Add buttons to initiate auth sequence and sign out-->
		<button id="authorize-button" style="display: none;">Authorize</button>
		<button id="signout-button" style="display: none;">Sign Out</button>

		<pre id="content"></pre>
	</div>

	<!-- This below scriptis all Google authorization-->
	<script type="text/javascript" src="./googleauth.js">
      // Client ID and API key from the Developer Console
      var CLIENT_ID = '808566611125-2l9q7j7ih5vuiis2qdpvloisc07d1mnk.apps.googleusercontent.com';
      var API_KEY = 'AIzaSyAHZZV_38Reo2tNW4VSC5OdKVHZ06xsWkw';

      // Array of API discovery doc URLs for APIs used by the quickstart
      var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      var SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

      var authorizeButton = document.getElementById('authorize-button');
      var signoutButton = document.getElementById('signout-button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
       function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
       function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
        });
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
       function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
          listUpcomingEvents();
        } else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
       function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
       function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node. Used to display the results of the API call.
       *
       * @param {string} message Text to be placed in pre element.
       */
       function appendPre(message) {
        var pre = document.getElementById('content');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }

      /**
       * Print the summary and start datetime/date of the next ten events in
       * the authorized user's calendar. If no events are found an
       * appropriate message is printed.
       */
       function listUpcomingEvents() {
        gapi.client.calendar.events.list({
          'calendarId': 'primary',
          'timeMin': (new Date()).toISOString(),
          'showDeleted': false,
          'singleEvents': true,
          'maxResults': 10,
          'orderBy': 'startTime'
        }).then(function(response) {
          var events = response.result.items;
          appendPre('Upcoming events:');

          if (events.length > 0) {
            for (i = 0; i < events.length; i++) {
              var event = events[i];
              var when = event.start.dateTime;
              if (!when) {
                when = event.start.date;
              }
              appendPre(event.summary + ' (' + when + ')')
            }
          } else {
            appendPre('No upcoming events found.');
          }
        });
      }

    </script>
	<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>
</body>
</html>